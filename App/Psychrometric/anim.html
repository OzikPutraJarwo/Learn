<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Psychrometric Chart Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }

    img {
      width: 100%;
    }

    main {
      display: grid;
      grid-template-columns: 1fr 2fr;
    }

    #chart {
      position: relative;
      display: inline-block;
      border: 1px solid #ccc;
      cursor: crosshair;
      line-height: 0;
      font-size: 0;
    }

    #marker {
      position: absolute;
      width: 10px;
      height: 10px;
      background-color: red;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
      display: none;
    }

    #output,
    #manualInput {
      margin-top: 20px;
    }

    .param {
      margin: 4px 0;
    }

    label {
      display: inline-block;
      width: 140px;
    }
  </style>
</head>

<body>

  <h2>Psychrometric Chart Calculator</h2>

  <main>

    <div id="inout">

      <!-- Manual Input -->
      <div id="manualInput">
        <h3>Input Manual</h3>
        <form id="manualForm">
          <label for="inputDryBulb">Suhu Kering (¬∞C):</label>
          <input type="number" id="inputDryBulb" step="0.1" required>
          <br>
          <label for="inputHumidityRatio">Humidity Ratio (g/kg):</label>
          <input type="number" id="inputHumidityRatio" step="0.1" required>
          <br><br>
          <button type="submit">Tampilkan Titik</button>
        </form>
      </div>
  
      <!-- Output -->
      <div id="output">
        <h3>Hasil:</h3>
        <div class="param">üå°Ô∏è Suhu Kering (Dry Bulb): <span id="dryBulb">-</span> ¬∞C</div>
        <div class="param">üíß Humidity Ratio (W): <span id="humidityRatio">-</span> g/kg</div>
        <div class="param">üî• Entalpi (h): <span id="enthalpy">-</span> kJ/kg</div>
        <div class="param">üå´Ô∏è RH (Kelembaban Relatif): <span id="rh">-</span> %</div>
        <div class="param">üßä Suhu Titik Embun (Dew Point): <span id="dewPoint">-</span> ¬∞C</div>
        <div class="param">üí® Suhu Basah (Wet Bulb): <span id="wetBulb">-</span> ¬∞C</div>
        <div class="param">üí® Tekanan Uap Air: <span id="vp">-</span> kPa</div>
        <div class="param">üì¶ Volume Spesifik: <span id="vSpec">-</span> m¬≥/kg d.a.</div>
      </div>

    </div>
    
    <!-- Chart -->
    <div id="chart">
      <img id="chartImage" src="image2.png" alt="Psychrometric Chart" draggable="false">
      <div id="marker"></div>
    </div>

  </main>




  <script>
    const chart = document.getElementById('chartImage');
    const marker = document.getElementById('marker');
    const form = document.getElementById('manualForm');

    const elements = {
      dryBulb: document.getElementById('dryBulb'),
      humidityRatio: document.getElementById('humidityRatio'),
      enthalpy: document.getElementById('enthalpy'),
      rh: document.getElementById('rh'),
      dewPoint: document.getElementById('dewPoint'),
      wetBulb: document.getElementById('wetBulb'),
      vp: document.getElementById('vp'),
      vSpec: document.getElementById('vSpec'),
    };

    const updateFromValues = (dryBulb, humidityRatio) => {
      const width = chart.width;
      const height = chart.height;

      // Convert value to position
      const x = ((dryBulb + 10) / 60) * width;
      const y = (1 - (humidityRatio / 0.030)) * height;

      // Show marker
      marker.style.left = `${x}px`;
      marker.style.top = `${y}px`;
      marker.style.display = 'block';

      // Calculate parameters
      const h = 1.006 * dryBulb + humidityRatio * (2501 + 1.86 * dryBulb);
      // const h = 1.006 * dryBulb + humidityRatio * (2501 + 1.86 * dryBulb);
      const p_atm = 101.325;
      const pws = 0.61078 * Math.exp((17.27 * dryBulb) / (dryBulb + 237.3));
      const pv = (humidityRatio * p_atm) / (0.622 + humidityRatio);
      const rh = (pv / pws) * 95;

      const a = 17.27, b = 237.7;
      const alpha = Math.log(pv / 0.61078);
      const dewPoint = (b * alpha) / (a - alpha);

      const tw = dryBulb * Math.atan(0.151977 * Math.sqrt(rh + 8.313659)) +
        Math.atan(dryBulb + rh) - Math.atan(rh - 1.676331) +
        0.00391838 * Math.pow(rh, 1.5) * Math.atan(0.023101 * rh) - 4.686035;

      const R_da = 0.287042;
      const T_k = dryBulb + 273.15;
      const v = R_da * T_k * (1 + 1.6078 * humidityRatio) / p_atm;

      form.addEventListener('submit', function (e) {
        e.preventDefault();
        const dryBulb = parseFloat(document.getElementById('inputDryBulb').value);
        const humidityRatio_gkg = parseFloat(document.getElementById('inputHumidityRatio').value);
        const humidityRatio = humidityRatio_gkg / 1000; // konversi ke kg/kg
        updateFromValues(dryBulb, humidityRatio);
      });

      // Update UI
      elements.dryBulb.textContent = dryBulb.toFixed(1);
      elements.humidityRatio.textContent = (humidityRatio * 1000).toFixed(1); // tampilkan dalam g/kg
      elements.enthalpy.textContent = h.toFixed(1);
      elements.rh.textContent = rh.toFixed(1);
      elements.dewPoint.textContent = dewPoint.toFixed(1);
      elements.wetBulb.textContent = tw.toFixed(1);
      elements.vp.textContent = pv.toFixed(3);
      elements.vSpec.textContent = v.toFixed(3);
    };

    // From manual form
    form.addEventListener('submit', function (e) {
      e.preventDefault();
      const dryBulb = parseFloat(document.getElementById('inputDryBulb').value);
      const humidityRatio = parseFloat(document.getElementById('inputHumidityRatio').value);
      updateFromValues(dryBulb, humidityRatio);
    });

    let isTracking = false; // default: tidak aktif

// Aktifkan tracking saat klik kiri di gambar
chart.addEventListener('mousedown', function (e) {
  if (e.button === 0) { // Klik kiri
    isTracking = true;
  }
});

// Nonaktifkan tracking saat klik kanan di gambar
chart.addEventListener('contextmenu', function (e) {
  e.preventDefault(); // cegah menu konteks muncul
  isTracking = false;
});

// Update marker dan nilai hanya jika tracking aktif
chart.addEventListener('mousemove', function (e) {
  if (!isTracking) return;

  const rect = chart.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  const width = chart.width;
  const height = chart.height;

  if (x < 0 || y < 0 || x > width || y > height) return;

  const dryBulb = -10 + (x / width) * 60;
  const humidityRatio = (1 - (y / height)) * 0.030;

  updateFromValues(dryBulb, humidityRatio);
});



    
  </script>

</body>

</html>